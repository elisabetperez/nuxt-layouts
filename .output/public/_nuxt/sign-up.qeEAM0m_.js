import{_ as y}from"./nuxt-link.e-sgaRED.js";import{C as x,D as U,E as h,H as i,o as m,c as d,a as n,I as V,b as t,w as p,v as r,y as M,d as L}from"./entry.OtO-Wuic.js";import{u as T}from"./useAuth.swlTjCW5.js";const A={class:"f--container"},H={class:"f--row"},k=n("div",{class:"f--col-12"},[n("h2",{class:"f--font-a"},"Sign up")],-1),S={class:"f--col-6"},F=["innerHTML"],I=["innerHTML"],N=n("button",{type:"submit",class:"c--btn-a"},"Sign Up",-1),P=n("hr",null,null,-1),W=x({__name:"sign-up",setup(B){const{validateEmail:w}=T(),c=U(),o=h({email:"",password:""}),e=h({loading:!1,success:"",error:"",errorMessage:"",hintMessage:"",inputError:!1,errorPasswordMessage:""}),b=async()=>{const{data:a}=await c.from("Users").select("*");if(a)return a.some(s=>s.email==o.email)},E=async a=>{try{const{data:s,error:l}=await c.from("Users").insert({email:a.email,full_access:"FALSE",user_id:a.id}).select();return s}catch(s){console.log(s)}},C=async()=>{try{if(!w(o.email)){e.errorMessage="Enter a valid email.",e.inputError=!0;return}if(await b()){e.errorMessage="User Already exists",e.inputError=!0;return}else e.errorMessage="",e.inputError=!1;var{data:a,error:s}=await c.auth.signUp({email:o.email,password:o.password,options:{emailRedirectTo:"/auth/log-in"}});a.user&&E(a.user),s?(e.error=s.message,e.inputError=!0):(e.error="",e.success="All set! We've sent you a confirmation email. Please go to your mailbox and complete confirmation process. Thank you.",o.email="",o.password="",e.inputError=!1)}catch(l){console.log(l),e.inputError=!0}};return(a,s)=>{const l=i("Label"),f=i("TextField"),_=i("ErrorAndHint"),g=i("FormGroup"),v=y;return m(),d("div",A,[n("div",H,[k,n("div",S,[n("form",{onSubmit:V(C,["prevent"])},[t(g,{formClass:"c--form-group-a"},{default:p(()=>[t(l,{forId:"email",labelClass:"c--form-label-a",textLabel:""}),t(f,{type:"text",modelValue:r(o).email,"onUpdate:modelValue":s[0]||(s[0]=u=>r(o).email=u),id:"email",inputClass:"c--form-input-a",placeholder:"Email",error:r(e).inputError},null,8,["modelValue","error"]),t(_,{errorMessage:r(e).errorMessage,errorClass:"c--form-error-a",hintMessage:r(e).hintMessage,hintClass:"c--form-hint-a"},null,8,["errorMessage","hintMessage"])]),_:1}),t(g,{formClass:"c--form-group-a"},{default:p(()=>[t(l,{forId:"password",labelClass:"c--form-label-a",textLabel:""}),t(f,{type:"password",modelValue:r(o).password,"onUpdate:modelValue":s[1]||(s[1]=u=>r(o).password=u),id:"password",inputClass:"c--form-input-a",placeholder:"Password",error:r(e).inputError},null,8,["modelValue","error"]),t(_,{errorMessage:r(e).errorPasswordMessage,errorClass:"c--form-error-a",hintMessage:r(e).hintMessage,hintClass:"c--form-hint-a"},null,8,["errorMessage","hintMessage"])]),_:1}),r(e).error?(m(),d("div",{key:0,class:"c--form-error-a",innerHTML:r(e).error},null,8,F)):M("",!0),r(e).success?(m(),d("div",{key:1,class:"c--form-success-a",innerHTML:r(e).success},null,8,I)):M("",!0),N,P,t(v,{to:"/",class:"c--btn-a c--btn-a--second"},{default:p(()=>[L("home")]),_:1})],32)])])])}}});export{W as default};
